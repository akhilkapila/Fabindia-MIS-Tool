2025-12-12 12:56:04,637 - INFO - Starting process: process_sales
2025-12-12 12:56:04,637 - INFO - Received sales process request
2025-12-12 12:56:07,727 - INFO - Loading file: SalesReportAbstract.csv from sheet 'SalesReportAbstract' starting at row 6
2025-12-12 12:56:13,232 - INFO - ✓ File loaded successfully - shape: (67544, 230)
2025-12-12 12:56:13,242 - INFO - Loaded data - shape: (67544, 230), columns: ['RegionName', 'StoreName', 'StoreCode', 'AlternateStoreCode', 'StoreGSTNumber', 'BillDate', 'BillTime', 'BillNumber', 'CustomerCode', 'CustomerName', 'AlternateCustomerCode', 'CustomerGSTNumber', 'MobileNumber', 'Email', 'DOB', 'DOA', 'DoctorName', 'PatientName', 'Quantity', 'Discount', 'DiscountPercentage', 'BaseValue', 'TNGSTAmount', 'CST', 'OtherTax', 'SGST', 'CGST', 'IGST', 'UTGST', 'Tax', 'Cash', 'Card', 'CreditCardType', 'Coupon', 'Credit', 'InsuranceCredit', 'CashAdvance', 'CreditCardAdvance', 'AdvancedAmount', 'GiftVoucher', 'CCNUsed', 'CCNIssued', 'PointsAllocated', 'PointsRedeemed', 'Cheque', 'PrepaidCard', 'OtherPayments', 'Amount', 'RefDate', 'RefTime', 'SyncTime', 'RefSeries', 'RefNo', 'Cenvat', 'Educess', 'Sheducess', 'Rod', 'CessAmt', 'OtherDebit', 'OtherCredit', 'DeliveryType', 'UserName', 'RemarksQuantity', 'RemarksWeight', 'Email ID', 'IsJobCardBill', 'TempCredit', 'AdditionalInformation', 'OtherDiscountAmount', 'OtherDiscountPercentage', 'OutletOwnership', 'ServiceTaxAmt', 'STCessAmount', 'STEduCessAmount', 'SalesmanName', 'SalesmanCode', 'ManualBillDate', 'ManualBillNo', 'MRPTotal', 'PolicyNumber', 'Remarks', 'Nationality', 'New customer Type', 'CustomerCreatedOn', 'PrintCount', 'BillSeries', 'OrderDate', 'OrderNumber', 'DiscountName', 'IntegrationId', 'CAAddress1', 'CAAddress2', 'CAAddress3', 'CACityName', 'CAStateName', 'TerminalNumber', 'PosType', 'DiscountApprovedBy', 'TransactionAttributes', 'AdditionalCESS', 'ZoneCode', 'ZoneName', 'BNumber', 'BillStartTime', 'StateName', 'TransactionValidity', 'TransID', 'DeviceType', 'CashRefund', 'SalesType', 'RefReturnDate', 'RefReturnNumber', 'RefReturnStore', 'CESS', 'StoreClusterName', 'CityName', 'Address1', 'Address2', 'Address3', 'PinCode', 'ShipmentDate', 'TransportName', 'ShipmentMethod', 'ShipmentTrackingNumber', 'ShipmentEnteredBy', 'ShipmentEnteredOn', 'ManualBillReferenceNo', 'WSDN', 'IRN', 'FreeValue', 'InsuranceCompanyCode', 'InsuranceCompanyName', 'OrderReferenceDate', 'OrderReferenceNo', 'AcknowledgeDate', 'AcknowledgeNumber', 'CustomerGroupName', 'ChannelName', 'TCS', 'Referral', 'BillDate1', 'BillSeries1', 'StoreCode1', 'TerminalNumber1', 'BillNumber1', 'Online Payment', 'PAYTM', 'PayTM DQR', 'PayU Payment', 'Promo', 'QC Wallet', 'Vouchagram', 'DeliveryAddress1', 'DeliveryAddress2', 'DeliveryAddress3', 'DeliveryState', 'DeliveryPinCode', 'Shipping Address 1', 'Shipping Address 2', 'Shipping Address 3', 'Shipping State', 'Shipping Pincode', 'Shipping StateName', 'ReferenceDocument', 'PivotStoreCode', 'OrderDeliveryAddress1', 'OrderDeliveryAddress2', 'OrderDeliveryAddress3', 'OrderDeliveryState', 'CustomerTierName', 'CustomerTypeName', 'FamilyMemberName', 'Relation4Customer', 'FamilyMemberDOB', 'JobCardDate', 'JobCardNumber', 'JobCardStore', 'EwayBillDate', 'EwayBillNumber', 'EwayTransportDocNo', 'EwayTransportDocDate', 'EwayValidFrom', 'EwayValidTo', 'RefChannelName', 'RefChannelOrderNo', 'InvoiceNumber', 'ShipmentNumber', 'ExternalID', 'OrderProcessMethod', 'InvoiceDate', 'BudgetDiscountValue', 'StoreAbbrevation', 'OrderReference', 'AlternateCode2', 'CompanyEmployeeID', 'ROD2', 'TINNumber', 'PODCityName', 'ShipToCityName', 'GrossWithDiscount', 'AverageSellingPrice', 'TransactionDate', 'BillType', 'TaxRefundStatus', 'StoreBrand', 'StoreType', 'ReferenceDocNo', 'Country', 'IsInsuranceBill', 'TotalCoPayerAmount', 'PrescriptionNo', 'BA Address1', 'BA Address2', 'BA Address3', 'BA Pincode', 'BA City', 'BA State', 'CPincode', 'CArea', 'PODArea', 'ShipToArea', 'TaxRefundAmount', 'TaxRefundReferenceNumber', 'GSTTaxType', 'ChargeBillDate', 'ChargeBillSeries', 'ChargeStoreCode', 'ChargeTerminalNumber', 'ChargeBillNumber', 'No.of Boxes']
2025-12-12 12:56:13,242 - INFO - ✓ Columns converted to uppercase: ['REGIONNAME', 'STORENAME', 'STORECODE', 'ALTERNATESTORECODE', 'STOREGSTNUMBER', 'BILLDATE', 'BILLTIME', 'BILLNUMBER', 'CUSTOMERCODE', 'CUSTOMERNAME']...
2025-12-12 12:56:13,242 - INFO - ✓ Mappings loaded successfully
2025-12-12 12:56:13,253 - INFO - ✓ Rename map created with 40 mappings
2025-12-12 12:56:13,404 - INFO - ✓ After rename: shape=(67544, 230)
2025-12-12 12:56:13,462 - INFO - ✓ After reindex: shape=(67544, 53), has 53 columns
2025-12-12 12:56:13,582 - INFO - ✓ Force-copied source 'ALTERNATESTORECODE' from input file to 'AlternateStoreCode' and 'StoreCode'
2025-12-12 12:56:13,747 - DEBUG - Removed 'BP' prefix from StoreCode
2025-12-12 12:56:13,920 - DEBUG - Removed 'BP' prefix from AlternateStoreCode
2025-12-12 12:56:14,802 - INFO - Removed 0 rows with prefixes ('97', '98')
2025-12-12 12:56:14,844 - INFO - ✓ BillDate parsed with DD-MM-YYYY format
2025-12-12 12:56:14,953 - INFO - Saving sales dataframe to Excel: shape=(67544, 53)
2025-12-12 12:58:07,775 - INFO - Saved processed sales to temp_uploads\2e8a14f7-0959-4845-97d6-b22e71e1afde_sales.xlsx
2025-12-12 12:58:07,775 - INFO - Output dataframe shape: (67544, 53), rows: 67544
2025-12-12 12:58:07,777 - INFO - File size after save: 13476991 bytes
2025-12-12 12:58:07,777 - INFO - Starting post-processing...
2025-12-12 12:58:07,778 - ERROR - post_process_workbook failed for Sales: name 'post_process_workbook' is not defined
Traceback (most recent call last):
  File "D:\Python Project\MIS Took\FinanceTool - Test - Working\app.py", line 728, in process_sales
    post_process_workbook(processed_filepath, sheets=None, min_data_row=2, logger=logger)
    ^^^^^^^^^^^^^^^^^^^^^
NameError: name 'post_process_workbook' is not defined
2025-12-12 12:58:07,792 - WARNING - Continuing without post-processing...
2025-12-12 12:58:07,792 - INFO - Reading file from disk to send to client: temp_uploads\2e8a14f7-0959-4845-97d6-b22e71e1afde_sales.xlsx
2025-12-12 12:58:07,799 - INFO - Successfully read file from disk: 13476991 bytes
2025-12-12 12:58:07,799 - INFO - Sending file to user
